<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="/src/tourism-guides-app/guide-list.html">
<link rel="import" href="/src/tourism-guides-app/place-list.html">
<link rel="import" href="/src/tourism-guides-app/place-card.html">
<link rel="import" href="/src/tourism-guides-app/place-data.html">
<link rel="import" href="/src/tourism-guides-app/guide-data.html">
<link rel="import" href="/src/tourism-guides-app/bad-url.html">

<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<dom-module id="aside-element">
    <template>
        <style>
            .content {
                position: fixed;
                left: 0px;
                top: 0px;
                width: 400px;
                height: 100%;
                background-color: white;
                overflow: scroll;
            }

            .scrollbar::-webkit-scrollbar-track {
                -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
                background-color: #F5F5F5;
            }

            .scrollbar::-webkit-scrollbar {
                width: 3px;
                background-color: #F5F5F5;
            }

            .scrollbar::-webkit-scrollbar-thumb {
                background-color: #000000;
                border: 2px solid #bfbfbf;
            }

            .routing {
                background-color: red;
                display: block;
                text-align: right;
            }
        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
        <app-location route="{{route}}"></app-location>
        <app-route route="{{route}}" pattern="/:page" data="{{data}}" tail="{{subroute}}">
        </app-route>    

        <app-route route="{{subroute}}" pattern="/:id" data="{{subrouteData}}">
        </app-route>

        <guide-data guides="{{guides}}">
        </guide-data>

        <place-data guides="{{guides}}" place-code="{{subrouteData.id}}" selected-guide="{{selectedGuide}}">
        </place-data>

        <iron-pages id="iron" selected="[[data.page]]" class="content scrollbar" attr-for-selected="path" fallback-selection="bar-url">
            <guide-list id="guideList" path="" on-guide-click="onGuideClick" guides="{{guides}}"></guide-list>
            <place-list id="placeList" path="places" on-place-click="onPlaceClick" on-back-button-click="onPlaceListBackClick" selected-guide="{{selectedGuide}}"></place-list>
            <place-card id="placeCard" path="place" selected-place="{{selectedPlace}}"></place-card>
            <bar-url id="bar-url" path="bar-url"></bar-url>
        </iron-pages>

    </template>
    <script>
        class AsideElement extends Polymer.Element {
            onGuideClick(event) {
                const selectedGuide = event.detail;

                const markers = selectedGuide.places.forEach(function(place) {
                    if (place.lat)
                        this.dispatchEvent(new CustomEvent('add-marker', {
                            detail: {
                                lat: place.lat,
                                lng: place.lng
                            }
                        }));
                }, this);

                this.selectedGuide = selectedGuide;
            }

            onPlaceListBackClick() {
                this.dispatchEvent(new CustomEvent("clean-map"));
            }

            onPlaceClick(event) {
                const placeClicked = event.detail;

                this.dispatchEvent(new CustomEvent('map-pan-to', {
                    detail: {
                        lat: placeClicked.lat,
                        lng: placeClicked.lng
                    }
                }));

                this.selectedPlace = placeClicked;
            }

            static get is() {
                return 'aside-element';
            }

            static get properties() {
                return {
                    selectedGuide: {},
                    selectedPlace: {}
                }
            }
        }

        window.customElements.define(AsideElement.is, AsideElement);
    </script>
</dom-module>