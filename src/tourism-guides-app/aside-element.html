<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="/src/tourism-guides-app/guide-list.html">
<link rel="import" href="/src/tourism-guides-app/place-list.html">
<link rel="import" href="/src/tourism-guides-app/place-card.html">
<link rel="import" href="/src/tourism-guides-app/place-data.html">
<link rel="import" href="/src/tourism-guides-app/guide-data.html">

<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<dom-module id="aside-element">
    <template>
        <style>
            .content{
                position: fixed;
                left: 0px;
                top: 0px;
                width: 400px;
                height: 100%;
                background-color: white;
                overflow: scroll;
            }

            .routing{
                background-color: red;
                display: block;
                text-align: right;
            }
        </style>
        <div class="routing">Page: {{ data.page }}</div>
        <div class="routing">Page: {{ subrouteData.id }}</div>
        <app-location route="{{route}}"></app-location>
        <app-route
            route="{{route}}"
            pattern="/:page"
            data="{{data}}"
            tail="{{subroute}}">
        </app-route>
        
        <app-route
            route="{{subroute}}"
            pattern="/:id"
            data="{{subrouteData}}">
        </app-route>
        <guide-data guides="{{guides}}">
        </guide-data>
    <iron-pages id="iron" selected="data.page" class="content" attr-for-selected="id">
        <guide-list id="guideList" on-guide-click="onGuideClick" guides="{{guides}}"></guide-list>
        <place-list id="placeList" on-place-click="onPlaceClick" selected-guide="{{selectedGuide}}" ></place-list>  
        <place-card id="placeCard" on-back-button="onPlaceCardBackButton" selected-place="{{selectedPlace}}" ></place-card>  
    </iron-pages>
    
    </template>
    <script>
        class AsideElement extends Polymer.Element {

            toString(obj) {
                return JSON.stringify(data)
            }

            ready() {
                super.ready();

                this.$.iron.selected = "guideList";
            }

            onPlaceCardBackButton(event) {
                this.$.iron.selected = "placeList";
            }

            onGuideClick(event) {
                const selectedGuide = event.detail;

                const markers = selectedGuide.places.forEach(function(place) {
                    if (place.lat)
                        this.dispatchEvent(new CustomEvent('add-marker', {
                            detail: {
                                lat: place.lat,
                                lng: place.lng
                            }
                        }));
                }, this);

                this.$.iron.selected = "placeList";

                this.selectedGuide = selectedGuide;
            }

            onPlaceClick(event) {
                const placeClicked = event.detail;

                this.dispatchEvent(new CustomEvent('map-pan-to', {
                    detail: {
                        lat: placeClicked.lat,
                        lng: placeClicked.lng
                    }
                }));

                this.selectedPlace = placeClicked;
                console.log(this.selectedPlace);
                this.$.iron.selected = "placeCard";
            }

            static get is() {
                return 'aside-element';
            }

            static get properties() {
                return {
                    guides: {},
                    selectedGuide: {},
                    selectedPlace: {}
                }
            }
        }

        window.customElements.define(AsideElement.is, AsideElement);
    </script>
</dom-module>